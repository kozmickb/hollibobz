import { ExpoConfig } from '@expo/config';

const NAME = process.env.APP_NAME ?? 'TripTick';
const SLUG = process.env.SLUG ?? 'triptick';
const OWNER = process.env.OWNER ?? 'kozmickb';
const PROJECT_ID = process.env.PROJECT_ID ?? undefined; // Will be generated by eas init
const BUNDLE_ID = process.env.IOS_BUNDLE_ID ?? 'com.triptick.app';
const ANDROID_PACKAGE = process.env.ANDROID_PACKAGE ?? 'com.triptick.app';

const updatesUrl = "https://u.expo.dev/62ed6c16-c869-42cd-b91c-c82a9e410526";

const config: ExpoConfig = {
  name: NAME,
  slug: SLUG,
  owner: OWNER,
  scheme: 'triptick',
  version: '1.0.0',
  orientation: 'portrait',
  // Temporarily disabled to bypass image processing permission issues
  // icon: './assets/TT logo.png',
  userInterfaceStyle: 'light',
  // Temporarily disabled to bypass image processing permission issues
  // splash: {
  //   image: './assets/TT logo.png',
  //   resizeMode: 'contain',
  //   backgroundColor: '#FF6B6B'
  // },
  assetBundlePatterns: [
    '**/*'
  ],
    ios: {
    bundleIdentifier: BUNDLE_ID,
    supportsTablet: true,
    infoPlist: {
      ITSAppUsesNonExemptEncryption: false,
      // iOS ATS dev exception (only for development)
      NSAppTransportSecurity: {
        NSAllowsArbitraryLoads: true
      },
      // iOS 17+ Calendar permissions (separate read/write keys)
      NSCalendarsFullAccessUsageDescription: "We use your calendar to read and update trip events you create.",
      NSCalendarsWriteOnlyAccessUsageDescription: "We add trip events to your calendar without reading other entries.",
      // iOS 17+ Reminders permissions (separate read/write keys)
      NSRemindersFullAccessUsageDescription: "We use reminders to read and manage trip tasks you create.",
      NSRemindersWriteOnlyAccessUsageDescription: "We add trip reminders without reading other entries.",
      // Camera and media library permissions for profile photos
      NSCameraUsageDescription: "We need camera access to take profile photos.",
      NSPhotoLibraryUsageDescription: "We need photo library access to select profile photos."
    }
  },
  android: {
    package: ANDROID_PACKAGE,
    permissions: ["READ_CALENDAR", "WRITE_CALENDAR", "CAMERA", "READ_EXTERNAL_STORAGE", "WRITE_EXTERNAL_STORAGE"],
    // Temporarily disabled to bypass image processing permission issues
    // adaptiveIcon: {
    //   foregroundImage: './assets/TT logo.png',
    //   backgroundColor: '#FF6B6B'
    // },
    // Temporarily disabled to bypass image processing permission issues
    // notificationIcon: './assets/TT logo.png'
  },
  plugins: [
    'expo-font',
    'expo-secure-store',
    './expo-plugins.js'
  ],
  extra: {
    eas: { projectId: "62ed6c16-c869-42cd-b91c-c82a9e410526" },
    LAN_IP: "localhost",
    API_BASE_URL: "http://localhost:8787"
  },
  updates: { url: updatesUrl },
  // Add cache configuration to prevent permission issues
  _internal: {
    isDebug: false,
  },
};

export default config;
